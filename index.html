
<!DOCTYPE html>
<html>
<head>
  <title>Mazda Airlines â€“ Request a Ride</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    form { margin-top: 30px; }
    input { padding: 10px; margin: 10px; width: 200px; }
    button { padding: 10px 20px; cursor: pointer; }
    .boarding-card {
      border: 2px dashed #888;
      background-color: #f9f9f9;
      margin: 30px auto;
      padding: 20px;
      border-radius: 10px;
      width: 300px;
    }
  </style>
</head>
<body>
  <h1>ðŸš— Mazda Airlines â€“ Ride Request</h1>
  <p>Enter your name and city to request a ride from Captain Simon!</p>
  <form id="requestForm">
    <input type="text" id="name" placeholder="Your Name" required><br>
    <input type="text" id="city" placeholder="Your City" required><br>
    <button type="submit">Submit Request</button>
  </form>
  <p id="statusMessage"></p>
  <div id="boardingPass"></div>

  <script>
    const flightPrefixes = ["MAZ", "LB", "ZGH", "YALLA", "SIM", "LBN"];
    const gateJokes = [
      "Gate A7 â€“ near the shawarma stand",
      "Gate B3 â€“ past the third pothole",
      "Gate Z1 â€“ next to the guy selling mana2eesh",
      "Gate M4 â€“ beside the broken roundabout",
      "Gate C2 â€“ near the loud dabke wedding",
      "Gate D9 â€“ under the hanging wires",
      "Gate E5 â€“ past the shortcut with 4 speed bumps"
    ];
    const jokes = [
      "Brian â€“ Always late. Needs a round of applause if he's ever early.",
      "Vic â€“ Always in the gym. Might board with protein powder in his carry-on.",
      "Kerkor â€“ Always trying to kill someone in football. Slide tackles at takeoff.",
      "Ric â€“ Canâ€™t board without snacks. Last time he brought chips, they lived in the Mazda longer than some of our friendships.",
      "GAF â€“ Thinks he's a doctor, but almost killed me last time. Board at your own risk.",
      "Ray â€“ Always puts music in the carâ€¦ I just wish they were all good.",
      "If this flight had leg day, Vic wouldâ€™ve already been here.",
      "Brian probably missed this flight too. Classic.",
      "GAFâ€™s prescription for turbulence? Panadol and vibes.",
      "Kerkorâ€™s boarding pass says â€˜slide tackle readyâ€™. Proceed with caution.",
      "No seatbelts, no snacksâ€¦ but I might be at your door in 15 minutes. Buckle up (emotionally).",
      "Delays? Never heard of her. I operate on vibes and Google Maps.",
      "Our in-flight service includes music from my busted speakers and sharp turns you didnâ€™t ask for.",
      "No turbulence. Just Lebanese roads.",
      "Book now. No refunds. No mercy.",
      "In case of emergency, pray I donâ€™t miss the exit.",
      "Now boarding: Anyone who can handle 180 km/h in a 50 zone."
    ];

    document.getElementById('requestForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('name').value.trim();
      const city = document.getElementById('city').value.trim();
      localStorage.setItem('mazdaUserName', name);
      const res = await fetch('/requests', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, city })
      });
      if (res.ok) {
        document.getElementById('statusMessage').textContent = "Request sent! Wait for the captain's approval.";
      } else {
        document.getElementById('statusMessage').textContent = "Error. Try again.";
      }
    });

    async function checkApproval() {
      const name = localStorage.getItem('mazdaUserName');
      if (!name) return;

      const res = await fetch('/requests');
      const data = await res.json();
      const user = data.find(p => p.name === name && p.status === 'approved');
      if (user) {
        const flight = `${flightPrefixes[Math.floor(Math.random() * flightPrefixes.length)]}-${Math.floor(100 + Math.random() * 900)}`;
        const gate = gateJokes[Math.floor(Math.random() * gateJokes.length)];
        const joke = jokes[Math.floor(Math.random() * jokes.length)];

        const passDiv = document.getElementById('boardingPass');
        passDiv.innerHTML = `
          <div class="boarding-card">
            <strong>${user.name}</strong><br>
            City: ${user.city}<br>
            Flight: ${flight}<br>
            Gate: ${gate}<br>
            ETA: ${user.eta}<br><br>
            <em>"${joke}"</em>
          </div>
        `;
      }
    }

    checkApproval();
  </script>
</body>
</html>
